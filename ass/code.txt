; ************************************************************
;       Programme: code.txt     version PEP813 sous Windows
;
;       Un programme qui valide un nom de famille.
;
;       auteur:         Andy Chen
;       code permanent: CHEA23099303
;       courriel:       chen.andy@courrier.uqam.ca
;       date:           12-02-2019
;       cours:          INF2171
; ***********************************************************
;
         LDA     0,i         ;initialisation à 0 du registre accumulateur
         LDX     0,i
         STRO    bienvenu,d  ;message bienvenue 
         STRO    progVali,d
         STRO    msgQuit,d 
debut:   STRO    msgEntre,d  ;message d'invite 
bclLect: CHARI   caract,d    ;l'input de l'utilisateur
         LDA     avCaract,d
         CPA     '\n',i      
         BREQ    div10        
         CPA     ' ',i	      ;verification des caractères interdit
         BREQ    bclLect     ;ou bien des caractères spéciaux      
         CPA     '-',i 	     
         BREQ    tiret       
         CPA     'A',i       
         BRLT    erreur 
         CPA     'Z',i 
         BRLE    verifVoy
         CPA     'a',i
         BRLT    erreur 
         CPA     'z',i 
         BRLE    transMin 
         BR      erreur
         
transMin:SUBA    0x0020,i
         STBYTEA caract,d
verifVoy:LDX     0,i	       ;vérifier si voyelle et on multiplie par deux
         STX     temApTr,d
         CPA     'A',i
         BREQ    multi2      
         CPA     'E',i
         BREQ    multi2   
         CPA     'I',i
         BREQ    multi2   
         CPA     'O',i
         BREQ    multi2   
         CPA     'U',i
         BREQ    multi2   
         CPA     'Y',i
         BREQ    multi2
         BR      ltrNorm     ;sinon lettre normale
multi2:  SUBA    'A',i       
         ADDA    1,i
         ASLA    
         ADDA    totalCal,d  ;on aditionne a totalCal
         STA     totalCal,d
         BR      bclLect
ltrNorm: SUBA    'A',i       
         ADDA    1,i
         ADDA    totalCal,d
         STA     totalCal,d
         BR      bclLect 
tiret:   LDX     temApTr,d   ;gere le cas de tiret
         BRNE    erreur
         ;CPX     ' ',i
         ;BREQ    erreur
         LDX     1,i 
         STX     temApTr,d
         LDA     totalCal,d
         ADDA    27,i        
         STA     totalCal,d
         BR      bclLect
apost:   LDX     temApTr,d   ;gere le cas de apostrophe
         BRNE    erreur
         LDX     1,i 
         STX     temApTr,d
         LDA     totalCal,d
         ADDA    28,i        ;si c'est un apostrophe, on ajoute 28
         STA     totalCal,d
         BR      bclLect 
enter:   LDX     temApTr,d 
         BRNE    fin           
div10:   LDA     totalCal,d
         LDX     0,i
bcldiv10:SUBA    divis,i     ;on boucle jusqu'à c'est négatif
         ADDX    1,i
         CPA     0,i         
         BRGE    bcldiv10
         ADDA    divis,i     ;quand c'est négatif, on re-ajoute le divis
         SUBX    1,i
         STA     reste,d
         STX     res,d  
affich:  STRO    msgVali1,d  ;on affiche les messages de validation
         DECO    reste,d 
         STRO    msgVali2,d      
         LDA     0,i         ;on vide totalCal
         STA     totalCal,d  
         BR      debut 
erreur:  STRO    msgErr,d  
bclTamp: CHARI   caract,d    ;on vide le tampon
entTamp: LDA     avCaract,d  
         CPA     '\n',i
         BREQ    debut
         BR      bclTamp
fin:     STRO    msgFin,d
         STOP

bienvenu:.ASCII  "Bienvenue au TP1 - \x00" 
progVali:.ASCII  "programme de validation de nom de famille:\n\n\x00"
msgQuit: .ASCII  "Pour quitter, entrer ENTER\n\x00"
msgEntre:.ASCII  "Veuillez entrer votre nom de famille:\x00"
msgErr:  .ASCII  "\nEntrée invalide\n\n\x00"
msgVali1:.ASCII  "\nLe code de validation est \x00"
msgVali2:.ASCII  ".\n\n\x00"
msgFin:  .ASCII  "\nFin du programme.\x00"
avCaract:.BLOCK  1
caract:  .BLOCK  1               
totalCal:.BLOCK  2           ;#2d
divis:   .EQUATE 10          ;#2d
res:     .BLOCK 2            ;#2d
reste:   .BLOCK 2            ;#2d
temApTr: .BLOCK 2 
t:       .BLOCK 2           
         .END














